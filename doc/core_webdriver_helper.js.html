<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/webdriver/helper.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-common_schedule-Scheduler.html">Scheduler</a><ul class='methods'><li data-type='method'><a href="module-common_schedule-Scheduler.html#invok">invok</a></li></ul></li><li><a href="module-common_schedule-TaskList.html">TaskList</a><ul class='methods'><li data-type='method'><a href="module-common_schedule-TaskList.html#autoRakutennLogin">autoRakutennLogin</a></li><li data-type='method'><a href="module-common_schedule-TaskList.html#do">do</a></li><li data-type='method'><a href="module-common_schedule-TaskList.html#doSniper">doSniper</a></li><li data-type='method'><a href="module-common_schedule-TaskList.html#updateTodayQuote">updateTodayQuote</a></li></ul></li><li><a href="module-core_analyst-Analyst.html">Analyst</a><ul class='methods'><li data-type='method'><a href="module-core_analyst-Analyst.html#getKDList">getKDList</a></li></ul></li><li><a href="module-core_inspector-DdeInspector.html">DdeInspector</a><ul class='methods'><li data-type='method'><a href="module-core_inspector-DdeInspector.html#listen">listen</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#runServ">runServ</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#sendTick">sendTick</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#start">start</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#stop">stop</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#watchDde">watchDde</a></li><li data-type='method'><a href="module-core_inspector-DdeInspector.html#watchQuote">watchQuote</a></li></ul></li><li><a href="module-core_inspector-WebSocket.html">WebSocket</a><ul class='methods'><li data-type='method'><a href="module-core_inspector-WebSocket.html#close">close</a></li><li data-type='method'><a href="module-core_inspector-WebSocket.html#listen">listen</a></li></ul></li><li><a href="module-core_sniper-Sniper.html">Sniper</a><ul class='methods'><li data-type='method'><a href="module-core_sniper-Sniper.html#start">start</a></li><li data-type='method'><a href="module-core_sniper-Sniper.html#stop">stop</a></li><li data-type='method'><a href="module-core_sniper-Sniper.html#watch">watch</a></li></ul></li><li><a href="module-core_webdriver-WebDriver.html">WebDriver</a><ul class='methods'><li data-type='method'><a href="module-core_webdriver-WebDriver.html#end">end</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#getPrice">getPrice</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#init">init</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#marginBuy">marginBuy</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#marginSell">marginSell</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#refresh">refresh</a></li><li data-type='method'><a href="module-core_webdriver-WebDriver.html#toMargin">toMargin</a></li></ul></li><li><a href="module-market_gdb-Gdb.html">Gdb</a><ul class='methods'><li data-type='method'><a href="module-market_gdb-Gdb.html#calcK">calcK</a></li><li data-type='method'><a href="module-market_gdb-Gdb.html#get">get</a></li><li data-type='method'><a href="module-market_gdb-Gdb.html#makeNowS">makeNowS</a></li></ul></li><li><a href="module-market_hesonogoma-Hesonogoma.html">Hesonogoma</a><ul class='methods'><li data-type='method'><a href="module-market_hesonogoma-Hesonogoma.html#getStockList">getStockList</a></li></ul></li><li><a href="module-market_kdb-Kdb.html">Kdb</a><ul class='methods'><li data-type='method'><a href="module-market_kdb-Kdb.html#getHead">getHead</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-common_log.html">common/log</a><ul class='methods'><li data-type='method'><a href="module-common_log.html#~get">get</a></li><li data-type='method'><a href="module-common_log.html#~init">init</a></li></ul></li><li><a href="module-common_schedule.html">common/schedule</a></li><li><a href="module-common_util.html">common/util</a><ul class='methods'><li data-type='method'><a href="module-common_util.html#~getCsvData">getCsvData</a></li><li data-type='method'><a href="module-common_util.html#~getHttp">getHttp</a></li><li data-type='method'><a href="module-common_util.html#~getHttps">getHttps</a></li><li data-type='method'><a href="module-common_util.html#~getNowDate">getNowDate</a></li><li data-type='method'><a href="module-common_util.html#~getNowDatetime">getNowDatetime</a></li><li data-type='method'><a href="module-common_util.html#~getTrend">getTrend</a></li><li data-type='method'><a href="module-common_util.html#~isHoliday">isHoliday</a></li><li data-type='method'><a href="module-common_util.html#~isTradeDate">isTradeDate</a></li><li data-type='method'><a href="module-common_util.html#~isWeekend">isWeekend</a></li><li data-type='method'><a href="module-common_util.html#~leftpad">leftpad</a></li><li data-type='method'><a href="module-common_util.html#~sleep">sleep</a></li><li data-type='method'><a href="module-common_util.html#~toStockArr">toStockArr</a></li><li data-type='method'><a href="module-common_util.html#~toStockObj">toStockObj</a></li></ul></li><li><a href="module-core_analyst.html">core/analyst</a></li><li><a href="module-core_inspector.html">core/inspector</a></li><li><a href="module-core_sniper.html">core/sniper</a></li><li><a href="module-core_webdriver.html">core/webdriver</a></li><li><a href="module-core_webdriver_helper.html">core/webdriver/helper</a><ul class='methods'><li data-type='method'><a href="module-core_webdriver_helper.html#.errLogin">errLogin</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.login">login</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.marginBuy">marginBuy</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.marginCancel">marginCancel</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.marginSell">marginSell</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.spotBuy">spotBuy</a></li><li data-type='method'><a href="module-core_webdriver_helper.html#.toMargin">toMargin</a></li></ul></li><li><a href="module-market_gdb.html">market/gdb</a></li><li><a href="module-market_hesonogoma.html">market/hesonogoma</a></li><li><a href="module-market_kdb.html">market/kdb</a></li></ul><h3>Mixins</h3><ul><li><a href="globalNS.method1.html">method1</a></li></ul><h3>Global</h3><ul><li><a href="global.html#app">app</a></li><li><a href="global.html#bar">bar</a></li><li><a href="global.html#bloviate">bloviate</a></li><li><a href="global.html#foo">foo</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">core/webdriver/helper.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * web驱动模块帮助类
 * 
 * @module core/webdriver/helper
 */
import config from '../../config/config';
import logger from '../../common/log';
import moment from 'moment';
const acc = config.account;
const errUrl = 'https://www.rakuten-sec.co.jp/session_error.html';

module.exports = {
	/**
	 * 登录乐天账户
	 */
	login: function() {
		return this
			.url('https://www.rakuten-sec.co.jp/')
			.setValue('#form-login-id', acc.id)
			.setValue('#form-login-pass', acc.pass)
			.click('.s1-form-login__btn')
			.waitForExist('#str-main-inner', 1000)
			//シャク　リュウキ　様のホームページ
			.getText('.mbodyb').then(function(result) {
				console.log(result);
			}).pause(500)
			// 自動ログアウトoff
			.click('#changeAutoLogout').pause(500)
			.alertAccept();
	},
	/**
	 * 現物购买
	 * @param  {Object} opt 参数对象
	 * @param  {string} opt.code 股票代码
	 * @param  {string} opt.volume 数量(株/口)
	 * @param  {string} opt.price 价格
	 */
	spotBuy: function(opt) {
		return this
			// 国内株式
			.click('#gmenu_domestic_stock')
			// 買い注文(現物)
			.click('#ord1').click('#jp-stk-top-btn-ord-spot-buy')
			// 銘柄名･銘柄コード
			.setValue('#ss-02', opt.code)
			// 検索
			.click('.img-ipad')
			// 股价自动更新
			.click('#autoUpdateButtonOn')
			// 数量( 株/口)
			.setValue('#orderValue', opt.volume)
			// 価格
			.setValue('#marketOrderPrice', opt.price)
			.setValue('*[type="password"]', acc.otp)
			// 確認画面を省略する
			.click('#ormit_checkbox')
			//注文
			.click('#ormit_sbm');
	},
	/**
	 * 进入信用交易界面
	 * @param  {Object} opt 参数对象
	 * @param  {string} opt.code 股票代码
	 */
	toMargin: function(opt) {
		return this
			// 国内株式
			.click('#gmenu_domestic_stock')
			// 買い注文(現物)
			.click('#ord2').click('#jp-stk-top-btn-ord-mgn-new')
			// 銘柄名･銘柄コード
			.setValue('#ss-02', opt.code)
			// 検索
			.click('.img-ipad')
			// 股价自动更新
			.click('#autoUpdateButtonOn');

	},
	toMarginSach: function(opt) {
		return this
			// 国内株式
			.click('#gmenu_domestic_stock')
			// 注文
			.click('#nav-sub-menu-order-arrow')
			.click('span=信用取引')
			// 注文照会・訂正・取消
			.click('.nav-tab-01 li:nth-last-child(1)')
			// 「表示する」 检索
			.click('.ord_jp_req_search input[src="/member/images/btn-disp.png"]')
			// 取消
			.click('a=取消')
			.setValue('*[type="password"]', acc.otp)
			// 取消注文
			.click('#sbm')
			/*// 銘柄名･銘柄コード
			.setValue('#ss-02', opt.code)
			// 検索
			.click('.img-ipad')
			// 股价自动更新
			.click('#autoUpdateButtonOn');*/

	},
	/**
	 * 信用购买
	 * @param  {Object} opt 参数对象
	 * @param  {string} opt.volume 数量(株/口)
	 * @param  {string} opt.price 价格
	 */
	marginBuy: function(opt) {
		return this
			// 売買区分->買建
			.click('.stockm #buy')
			// 信用区分（期限）-> 制度（6ヶ月）
			.click('#mgnMaturityCd_system_6m')
			// 数量( 株/口)
			.setValue('#orderValue', opt.volume)
			// 価格
			.setValue('#marketOrderPrice', opt.price)
			.setValue('*[type="password"]', acc.otp)
			// 確認画面を省略する
			.click('#ormit_checkbox')
			//注文
			.click('#ormit_sbm');
	},
	/**
	 * 信用卖出
	 * @param  {Object} opt 参数对象
	 * @param  {string} opt.price 价格
	 */
	marginSell: function(opt) {
		let that = this;
		return that
			// 返済注文(1:新規注文,2:返済注文,3:現引現渡注文,4:注文照会・訂正・取消)
			.click('.nav-tab-01 li:nth-child(2)')
			// 返済注文按钮
			.click('#special_table .tbl-data-01>tbody>tr:last-child img[src="/member/images/btn-repayment-02.gif"]')
			// 获取卖单损益额
			.getText('#form > table:nth-child(17) > tbody > tr:nth-child(1) > td:nth-child(1) > table > tbody > tr:last-child')
			.then(function(res) {
				let raw = res.split('\n');
				let [profit, buyDate] = [raw[5], raw[6]];
				logger.info('卖单损益额:', profit, '円');
				// 卖单损益额大于1000时运行卖单执行 并且建日为当天
				if (profit > 1000 &amp;&amp; moment().format('YYYY/MM/DD') == buyDate) {
					that
					// 选择最后一个持仓股票
						.click('input[name="chkRepay' + (len - 1) + '"]')
						// 価格
						.setValue('#marketOrderPrice', opt.price)
						.setValue('*[type="password"]', acc.otp)
						// 確認画面を省略する
						.click('#ormit_checkbox')
						//注文
						.click('#ormit_sbm');
				} else {
					logger.info('无短线卖单！')
				}

			});
	},
	/**
	 * 信用买单取消
	 * @param  {Object} opt 参数对象
	 * @param  {string} opt.price 价格
	 */
	marginCancel: function(opt) {
		return this
			// 国内株式
			.click('#gmenu_domestic_stock')
			// 注文
			.click('#nav-sub-menu-order-arrow')
			.click('span=信用取引')
			// 注文照会・訂正・取消
			.click('.nav-tab-01 li:nth-last-child(1)')
			// 「表示する」 检索
			.click('.ord_jp_req_search input[src="/member/images/btn-disp.png"]')
			// 取消
			.click('a=取消')
			.setValue('*[type="password"]', acc.otp)
			// 取消注文
			.click('#sbm')
	},
	/**
	 * 错误界面重新登录
	 */
	errLogin: function() {
		this.getUrl().then(function(res) {
			if (res == errUrl) {
				return this
					.setValue('#form-login-id', acc.id)
					.setValue('#form-login-pass', acc.pass)
					.click('.s1-form-login__btn');
			}
		})
	}
};</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Sat Aug 05 2017 16:16:28 GMT+0900 (东京标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
